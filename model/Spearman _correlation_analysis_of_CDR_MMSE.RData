# read
file1 <- read.csv("output.csv")  
file2 <- read.csv("Reference_file.csv")  
  
# Connect left using dplyr
library(dplyr)  
result <- left_join(file1, file2, by = "name")  

head(result)  
write.csv(result, "merged_file.csv", row.names = FALSE)
#--------------------------------------------------------------- The above is the processing of csv files

#  --------------------------------------------------------------------------------- 
library(ggplot2)  
  
data <- read.csv("merged_file.csv", stringsAsFactors = FALSE)  
data <- na.omit(data)   
correlation_test_MMSE_AD <- cor.test(data$MMSE, data$AD, method = "spearman", exact = FALSE)  
R_value_MMSE_AD <- round(correlation_test_MMSE_AD$estimate, 2)
p_value_MMSE_AD <- correlation_test_MMSE_AD$p.value
  
# Draw scatter plots and trend lines of MMSE and AD probabilities, and add R values and p values to the plots 
#R_value_MMSE_AD <- sprintf("%.3f", R_value_MMSE_AD)
text <- paste("             R = ", sprintf("%.3f", R_value_MMSE_AD),"                     ", "\np-value = ", round(p_value_MMSE_AD, 9))  
p<-ggplot(data, aes(x = AD, y = MMSE)) +          
  geom_point() +  
  geom_smooth(method = "lm", se = TRUE, color = "red", fill = "red", alpha = 0.2) +      
  xlab("Weighted Voting") +      
  ylab("MMSE Score") +      
  ggtitle(text)+
  theme_minimal() + 
  theme(panel.background = element_blank(),     
        panel.grid.major = element_blank(), 
        panel.grid.minor = element_blank(),  
        axis.title.x = element_text(size = 16,face = "bold"),  
        axis.title.y = element_text(size = 16,face = "bold"),    
        axis.text.x = element_text(size = 12,face = "bold"), 
        axis.text.y = element_text(size = 12,face = "bold"),   
        plot.title = element_text(size = 15, face = "bold",hjust = 0.5),
        axis.line = element_line(colour = "black", size = 1)
        )

ggsave("MMSE.pdf", plot = p, width = 8, height = 6, dpi = 600)          

 
#----CDR diagram
data <- read.csv("merged_file.csv", stringsAsFactors = FALSE)  
data <- na.omit(data)   
correlation_test_CDR_AD <- cor.test(data$CDR, data$AD, method = "spearman", exact = FALSE)  
R_value_CDR_AD <- round(correlation_test_CDR_AD$estimate, 2)
p_value_CDR_AD <- correlation_test_CDR_AD$p.value
  
#Plot the scatter plot and trend line of MMSE and AD probabilities, and add R values and p values to the plot
text <- paste("            R = ", sprintf("%.3f", R_value_CDR_AD),"                      ", "\np-value = ", round(p_value_CDR_AD, 10))  
ggplot(data, aes(x = AD, y = CDR)) +      
  geom_point() +      
  geom_smooth(method = "lm", se = TRUE, color = "red", fill = "red", alpha = 0.2) +      
  xlab("Weighted Voting") +      
  ylab("CDR Score") +      
  ggtitle(text) +  
  theme_minimal() +  
  theme(panel.background = element_blank(),  
        panel.grid.major = element_blank(),  
        panel.grid.minor = element_blank(),  
        axis.title.x = element_text(size = 16,face = "bold"),  
        axis.title.y = element_text(size = 16,face = "bold"),    
        axis.text.x = element_text(size = 12,face = "bold"),  
        axis.text.y = element_text(size = 12,face = "bold"),  
        plot.title = element_text(size = 15, face = "bold",hjust = 0.5),
        axis.line = element_line(colour = "black", size = 1) 
        ) -> p
ggsave("CDR.pdf", plot = p, width = 8, height = 6, dpi = 600)